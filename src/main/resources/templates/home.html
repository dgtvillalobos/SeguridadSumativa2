<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inicio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" ></script>
</head>
<body class="bg-dark">

<div th:replace="fragments/header :: header"></div>

<div class="container mt-3">

<div id="carouselExampleCaptions" class="carousel slide">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="img/banner/banner1.jpg" class="d-block w-100" alt="Vista de montaña y lago">
      <div class="carousel-caption d-none d-md-block">
        <h1>Explora Nuestras Recetas</h1>
        <p>Inicia sesión para conocer nuestras recetas.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="img/banner/banner2.jpg" class="d-block w-100" alt="Perro golden retriever">
      <div class="carousel-caption d-none d-md-block">
        <h1>Busca la Receta que Necesites</h1>
        <p>ocupa nuestro buscador y selecciona según ingredientes, país, dificultad y más.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="img/banner/banner3.jpg" class="d-block w-100" alt="Puente icónico en la ciudad">
      <div class="carousel-caption d-none d-md-block">
        <h1>Próximamente Nuevas Recetas</h1>
        <p>En poco tiempo tendremos muchas más recetas para compartir contigo.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>


<!-- Buscador-->
<div class="card mt-3 bg-dark border-light">
  <div class="card-body">

<form class="row g-3 mb-4" method="get" th:action="@{/recetas}">
  <div class="col-md-2 text-center">
    <label class="form-label text-white">Nombre</label>
    <input class="form-control" name="nombre" th:value="${nombre}">
  </div>

  <div class="col-md-2 text-center">
    <label class="form-label text-white">Ingrediente</label>
    <input class="form-control" name="ingrediente" th:value="${ingrediente}" placeholder="ej: ajo">
  </div>

  <div class="col-md-2 text-center">
    <label class="form-label text-white">Tipo de cocina</label>
    <select class="form-select" name="tipo">
      <option value="">(cualquiera)</option>
      <option th:each="t : ${tipos}" th:value="${t}" th:text="${t}" th:selected="${t == tipo}"></option>
    </select>
  </div>

  <div class="col-md-2 text-center">
    <label class="form-label text-white">País</label>
    <select class="form-select" name="pais">
      <option value="">(cualquiera)</option>
      <option th:each="p : ${paises}" th:value="${p}" th:text="${p}" th:selected="${p == pais}"></option>
    </select>
  </div>

  <div class="col-md-2 text-center">
    <label class="form-label text-white">Dificultad</label>
    <select class="form-select" name="dificultad">
      <option value="">(cualquiera)</option>
      <option th:each="d : ${dificultades}" th:value="${d}" th:text="${d}" th:selected="${d == dificultad}"></option>
    </select>
  </div>

  <div class="col-md-2 d-flex align-items-end">
    <button class="btn btn-info me-2" type="submit">Buscar</button>
    <a class="btn btn-outline-secondary  text-white"
       th:href="@{/recetas}">Limpiar</a>
  </div>
</form>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-2 mt-3">
  <h5 class="mb-0 text-white" th:text="${hasFilters} ? 'Resultados' : 'Recetas recientes'">Recetas</h5>
  <span class="text-white" th:text="${count} + ' resultado(s)'">0 resultado(s)</span>
</div>

<!-- Si no hay resultados -->
<div th:if="${#lists.isEmpty(recetas)}" class="alert alert-info">
  No hay recetas que coincidan con los filtros.
</div>




<div class="row g-3 mt-2" th:if="${!#lists.isEmpty(recetas)}">
  <div class="col-md-4" th:each="r : ${recetas}">
    <div class="card h-100 shadow-sm">
      <div class="ratio ratio-4x3">
        <img th:src="@{/img/recetas/{f}(f=${r.imagenFile})}"
             class="w-100 h-100" style="object-fit: cover;"
             alt="foto" loading="lazy"
             onerror="this.src='/img/recetas/placeholder.jpg'">
      </div>
      <div class="card-body">
        <h5 class="card-title" th:text="${r.nombre}">Nombre</h5>
        <p class="card-text small mb-2">
          <span class="badge bg-secondary" th:text="${r.tipoCocina}">Tipo</span>
          <span class="badge bg-info text-dark" th:text="${r.paisOrigen}">País</span>
          <span class="badge bg-warning text-dark" th:text="${r.dificultad}">Dificultad</span>
        </p>
        <p class="small mb-2">
          <strong>Ingredientes:</strong>
          <span th:each="i, it : ${r.ingredientes}">
            <span th:text="${i}"></span><span th:if="${!it.last}">, </span>
          </span>
        </p>

        <a class="btn btn-sm btn-primary"
           sec:authorize="isAuthenticated()"
           th:href="@{'/detalle/' + ${r.id}}">
          Ver receta
        </a>

        <button class="btn btn-sm btn-outline-primary"
                sec:authorize="!isAuthenticated()"
                th:onclick="'showLoginAlert(' + ${r.id} + ');'">
          Ver receta
        </button>
      </div>
    </div>
  </div>
</div>

</div>

<div th:replace="fragments/footer :: footer"></div>

<script>
  function showLoginAlert(id) {
    Swal.fire({
      title: 'Debes iniciar sesión',
      text: 'Inicia sesión para ver ingredientes completos e instrucciones.',
      icon: 'info',
      showCancelButton: true,
      confirmButtonText: 'Ir a login',
      cancelButtonText: 'Cancelar'
    }).then(res => {
      if (res.isConfirmed) {
        window.location.href = '/login';
      }
    });
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" ></script>
</body>
</html>
